(function(e){var t={id:"fc731b10c3ac4c0a72f28461f4ce6866",filename:"AsyncRequest.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){var r=function(){this.reqs=[];this.status=0};r.prototype.addRequest=function(e){if(this.status!=0)return;this.reqs.push(e)};r.prototype.go=function(){if(this.status!=0)return;this.status=1;var e=this;var t=this.reqs;var n=this.reqs.length;for(var r=0;r<t.length;r++){var i=t[r];if(this.status==0)return;i(function(){n--;if(n==0){e.finish()}})}};r.prototype.finish=function(){this.status=0;if(this.onfinished){this.onfinished()}};r.prototype.clear=function(){if(this.status!=0)return;this.reqs=[]};t.exports=r}(t.exports,t,e);e.____MODULES["fc731b10c3ac4c0a72f28461f4ce6866"]=t.exports})(this);(function(e){var t={id:"ea4cff1a67c09f71313ed408c0bd08b6",filename:"RuleParser.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(e,t,n){function i(e){var t=[];for(var n=0;n<e.length;n++){var r=e.charAt(n);switch(r){case"(":case")":case"!":case"&":case"|":t.push(r);t.push("");break;default:t.length?t[t.length-1]+=r:t.push(r);break}}return t}function o(e){var t=[];var n=null;var i;while((i=e.shift())!==void 0){if(!i){continue}switch(i){case"(":case")":case"!":case"&":case"|":t.push(i);break;default:var o=i.match(s);if(!o)continue;if(o[1].charAt(0)=="@"){n={name:"@",elemName:o[1].replace("@","")}}else{n={name:o[1]}}if(!r[n.name]){throw"not found parser's name : "+n.name}if(o[2])n.value=o[2].replace("[","").replace("]","");t.push(n);n=null;break}}return t}var r={};var s=/^(@?\w+)(\[.+\])?$/;e.add=function(e,t){r[e]=t||{};r[e].name=e};e.parse=function(e){var t=i(e);var n=o(t);return n}}(t.exports,t,e);e.____MODULES["ea4cff1a67c09f71313ed408c0bd08b6"]=t.exports})(this);(function(__context){var module={id:"92f35280117faaf4f399138268a3a54b",filename:"Validator.js",exports:{}};if(!__context.____MODULES){__context.____MODULES={}}var r=function(exports,module,global){function FieldChecker(e){this.element=e;this.$element=$(e);this.$form=this.$element.closest("form");this.async=new Async}function FormValidator(e){if(!e)throw"[ERROR] form 参数必须存在.";if(e.tagName!=="FORM")throw"[ERROR] 参数 form 必须是个表单元素.";this.form=e;this.$form=$(e);this.async=new Async}function _exists(e){return $(e).closest("body").size()>0&&$(e).is(":visible")}function _getFieldValidator(e){if(!$(e).data(CONSTANT.PATTERN))return;return e._field_validator?e._field_validator:e._field_validator=new FieldChecker(e)}function _parse_selector_syntax(e){return(e||"").replace(/@([a-z][a-z0-9]*)\b/ig,"[name=$1]")}function addPattern(e,t){if(!e)throw"[ERROR] add pattern - no name";if(!t)throw"[ERROR] add pattern - no options";if(!t.message)throw"[ERROR] add pattern - no message";if(!t.validate)throw"[ERROR] add pattern - no validate";PATTERNS[e]=$.extend({name:e},t);parser.add(e,t)}var Async=__context.____MODULES["fc731b10c3ac4c0a72f28461f4ce6866"];var parser=__context.____MODULES["ea4cff1a67c09f71313ed408c0bd08b6"];var PATTERNS={};var CONSTANT={PATTERN:"jvalidator-pattern",PLACEHOLDER:"jvalidator-placeholder",CNAME:"jvalidator-cname",MESSAGE_ATTR:"__jvalidator_messages__",FIELD_EVENTS:"__jvalidator_events__",DEBUG:"jvalidator-debug"};FieldChecker.prototype={_getPatternMessage:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r.name){t.push(r.getMessage())}else{switch(r){case"&&":t.push(" 并且 ");break;case"||":t.push(" 或者 ");break;case"!":t.push("不");break}}}return t.join("")},_checkPatternResult:function(str,results){var self=this;var rstr=[];for(var i=0;i<results.length;i++){var p=results[i];if(p.name){rstr.push(p.result)}else{rstr.push(p)}}if(this.$form.data(CONSTANT.DEBUG)){console.info(this,this.element,str,rstr.join(""))}var all=eval(rstr.join(""));if(all){return[]}else{var arr=$.grep(results,function(e,t){return e.name&&e.result===false});arr.getMessage=function(){return self._getPatternMessage(results)};return arr}},checkPattern:function(){var e=this.$element;var t=e.data(CONSTANT.PATTERN);try{var n=parser.parse(t)}catch(r){console.error(this.element,"验证器语法有错误，请检查",t);console.error("错误可能是：",r)}},check:function(e,t){var n=this;var r=this.async;var i=this.element;var s=this.$element;var o=this.value();var u=s.data(CONSTANT.PATTERN);var a=parser.parse(u);r.clear();r.onfinished=function(){var r=n._checkPatternResult(u,a);if(t){t(r.length==0,r)}n.after_check(r.length==0,r,e)};$.each(a,function(){if(!this.name)return;var e=$.extend(this,{element:n.element,$element:n.$element,$form:n.$form,getMessage:function(){return n._getMessage.call(this,o)},parseNameSymbol:function(e){if(e.charAt(0)!=="@")return null;return this.$form.find(_parse_selector_syntax(e))[0]},getNameSymbol:function(){return this.parseNameSymbol("@"+this.elemName)},getValueSymbol:function(){var e=this.parseNameSymbol(this.value);return e?e:this.value},getElementValue:function(e){e=$(e)[0];if(!e)return"";var t=_getFieldValidator(e);return t?t.value():n.value.call({element:e,$element:$(e),$form:n.$form})},getElementName:function(e){var t=$(e);if(t.data(CONSTANT.CNAME)){return t.data(CONSTANT.CNAME)}else{return t.attr("name")}return""}},PATTERNS[this.name]);(function(e){r.addRequest(function(t){e.validate(o,function(n){e.result=n;t()})})})(e)});r.go()},_getMessage:function(e){var t=this;var n=this.name;var r=this.element;var i=this.$element;var s=this.$form;var o=e||_getFieldValidator(r).value();var u=(r[CONSTANT.MESSAGE_ATTR]?r[CONSTANT.MESSAGE_ATTR][n]:null)||(s[0][CONSTANT.MESSAGE_ATTR]?s[0][CONSTANT.MESSAGE_ATTR][n]:null)||PATTERNS[n].message;u=u.replace(/%val\b/g,o);u=u.replace(/%name\b/g,r.name);u=u.replace(/%cname\b/g,i.data(CONSTANT.CNAME));u=u.replace(/=%argu\b/g,function(){var e=t.parseNameSymbol(t.value);return e&&e.tagName?t.getElementValue(e):t.value});u=u.replace(/%argu\b/g,function(){var e=t.parseNameSymbol(t.value);return e&&e.tagName?t.getElementName(e):t.value});u=u.replace(/@@/g,function(e,n){var r=s.find(_parse_selector_syntax("@"+t.elemName))[0];if(!r){return""}else{var i=$(r);if(i.data(CONSTANT.CNAME)){return i.data(CONSTANT.CNAME)}else{return i.attr("name")}}});u=u.replace(/=@([^\s]*)\b/g,function(e,n){return t.getElementValue(s.find("[name="+n+"]"))});u=u.replace(/@([^\s]*)\b/g,function(e,n){return t.getElementName(s.find("[name="+n+"]"))||""});return u},value:function(){var e=this.element,t=this.$element,n=this.$form,r;switch(e.tagName.toLowerCase()){case"input":switch(e.type){case"radio":return n.find("input[name="+e.name+"]:radio:checked").val();case"checkbox":return n.find("input[name="+e.name+"]:checkbox:checked").map(function(){return this.value}).toArray().join(",");case"text":r=t.data(CONSTANT.PLACEHOLDER);return r===e.value?"":e.value;case"hidden":case"password":return e.value}break;case"select":return e.value;case"textarea":r=t.data(CONSTANT.PLACEHOLDER);return r===e.value?"":e.value}},after_check:function(e,t,n){var r=e?"success":"fail";var i=this.$element.data(CONSTANT.FIELD_EVENTS+r);if(!i)i=this.$form.data(CONSTANT.FIELD_EVENTS+r);if(!i||typeof i!="function")return;i.call(this,n,t)}};FormValidator.prototype={_getAllFieldValidator:function(){var e=this;return this.$form.find("[data-"+CONSTANT.PATTERN+"]").filter(function(){return _exists(this)&&!this.disabled}).map(function(){return _getFieldValidator(this)}).toArray()},checkAllPatterns:function(){var e=this._getAllFieldValidator();$.each(e,function(){this.checkPattern()})},validateAll:function(e){var t=this.$form;var n=this.async;var r=this._getAllFieldValidator();var i=[];n.clear();n.onfinished=function(){e&&e(i.length==0,i)};if(!r.length){return e(true,[])}for(var s=0;s<r.length;s++){var o=r[s];(function(e){n.addRequest(function(t){e.check(null,function(e,n){if(!e){i.push(n)}t()})})})(o)}n.go()},when:function(e,t){if(typeof e!="string"){t=e;e=""}var n={};var r=e||"[data-"+CONSTANT.PATTERN+"]";if($.isArray(t)){n[r]=t}else if($.isPlainObject(t)){$.extend(n,t)}var i=this.$form.find(r).find("input:checkbox");if(i.length){i.each(function(){r+=","+_parse_selector_syntax("@"+this.name)})}var s=this.$form.find(r).find("input:radio");if(s.length){s.each(function(){r+=","+_parse_selector_syntax("@"+this.name)})}for(var o in n){var u=_parse_selector_syntax(o);var a=n[o]||[];if(!a.length)continue;a=a.join(" ");this.$form.undelegate(u,a);this.$form.delegate(u,a,function(e){var t=_getFieldValidator(this);t&&t.check(e)})}},setMessage:function(e,t,n){if(arguments.length==2){n=t;t=e;e=null}var r,i=this.$form[0];if(!e){r=i[CONSTANT.MESSAGE_ATTR]=i[CONSTANT.MESSAGE_ATTR]||{};r[t]=n}else{this.$form.find(_parse_selector_syntax(e)).each(function(){var e=this;r=e[CONSTANT.MESSAGE_ATTR]=e[CONSTANT.MESSAGE_ATTR]||{};r[t]=n})}},success:function(e,t){this._bind_field_event("success",e,t)},fail:function(e,t){this._bind_field_event("fail",e,t)},_bind_field_event:function(e,t,n){if(!e)return;if(typeof t=="function"){n=t;t=null}if(t){var r=_parse_selector_syntax(t);this.$form.find(r).each(function(){$(this).data(CONSTANT.FIELD_EVENTS+e,n)})}else{this.$form.data(CONSTANT.FIELD_EVENTS+e,n)}}};$.fn.jvalidator=function(){var e=$(this).first();if(e.data("FormValidator"))return e.data("FormValidator");var t=new FormValidator(e[0]);e.data("FormValidator",t);return t};exports.addPattern=addPattern;$.extend({jvalidator:{addPattern:addPattern}})}(module.exports,module,__context);__context.____MODULES["92f35280117faaf4f399138268a3a54b"]=module.exports})(this);(function(e){var t={id:"4f65fcd12eaf8e3d436c0aacb3090d3a",filename:"index.js",exports:{}};if(!e.____MODULES){e.____MODULES={}}var n=function(t,n,r){var i=e.____MODULES["92f35280117faaf4f399138268a3a54b"];var s={ID:function(e){e=e.toUpperCase();if(!/(^\d{15}$)|(^\d{17}(\d|X)$)/.test(e)){return-1}var t,n;t=e.length;if(t==15){n=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var r=e.match(n);var i=new Date("19"+r[2]+"/"+r[3]+"/"+r[4]);var s=i.getYear()==Number(r[2])&&i.getMonth()+1==Number(r[3])&&i.getDate()==Number(r[4]);if(!s){return-2}else{return 1}}if(t==18){n=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})(\d|X)$/);var r=e.match(n);var i=new Date(r[2]+"/"+r[3]+"/"+r[4]);var s=i.getFullYear()==Number(r[2])&&i.getMonth()+1==Number(r[3])&&i.getDate()==Number(r[4]);if(!s){return-2}else{var o;var u=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var a=new Array("1","0","X","9","8","7","6","5","4","3","2");var f=0,l;for(l=0;l<17;l++){f+=e.substr(l,1)*u[l]}o=a[f%11];if(o!=e.substr(17,1)){return-2}return 1}}return-2}};i.addPattern("required",{message:"必须填写",validate:function(e,t){t(e!=="")}});i.addPattern("non-required",{message:"允许为空",validate:function(e,t){t(e==="")}});i.addPattern("numeric",{message:"必须是数字",validate:function(e,t){t(/^\d+$/.test(e))}});i.addPattern("int",{message:"必须是整数",validate:function(e,t){t(/^\-?\d+$/.test(e))}});i.addPattern("decimal",{message:"必须是小数",validate:function(e,t){t(/^\-?\d*\.?\d+$/.test(e))}});i.addPattern("alpha",{message:"必须是字母",validate:function(e,t){t(/^[a-z]+$/i.test(e))}});i.addPattern("alpha_numeric",{message:"必须为字母或数字",validate:function(e,t){t(/^[a-z0-9]+$/i.test(e))}});i.addPattern("alpha_dash",{message:"必须为字母或数字及下划线等特殊字符",validate:function(e,t){t(/^[a-z0-9_\-]+$/i.test(e))}});i.addPattern("chs",{message:"必须是中文字符",validate:function(e,t){t(/^[\\u4E00-\\u9FFF]+$/i.test(e))}});i.addPattern("chs_numeric",{message:"必须是中文字符或数字",validate:function(e,t){t(/^[\\u4E00-\\u9FFF0-9]+$/i.test(e))}});i.addPattern("chs_numeric",{message:"必须是中文字符或数字及下划线等特殊字符",validate:function(e,t){t(/^[\\u4E00-\\u9FFF0-9_\-]+$/i.test(e))}});i.addPattern("match",{argument:true,message:"必须与 %argu 相同",validate:function(e,t){var n=this.getValueSymbol();var r=n&&n.tagName?this.getElementValue(n):n;t(r===e)}});i.addPattern("contain",{argument:true,message:'必须包含"%argu"的内容',validate:function(e,t){var n=this.getValueSymbol();var r=n&&n.tagName?this.getElementValue(n):n;t(!!~e.indexOf(r))}});i.addPattern("@",{argument:true,message:"@@必须为 %argu",validate:function(e,t){var n=this.getValueSymbol();var r=this.getNameSymbol();if(n===null||r===null){t(false)}else{var i=n&&n.tagName?this.getElementValue(n):n;var s=r&&r.tagName?this.getElementValue(r):r;t(i===s)}}});i.addPattern("idcard",{message:"身份证格式错误",validate:function(e,t){t(s.ID(e)===1)}});i.addPattern("passport",{message:"护照格式错误或过长",validate:function(e,t){t(/^[a-zA-Z0-9]{0,20}$/i.test(e))}});i.addPattern("email",{message:"邮件地址错误",validate:function(e,t){t(/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/.test(e))}});i.addPattern("min_length",{argument:true,message:"最少输入%argu个字",validate:function(e,t){var n=parseInt(this.value,10);t(e.length>=n)}});i.addPattern("max_length",{argument:true,message:"最多输入%argu个字",validate:function(e,t){var n=parseInt(this.value,10);t(e.length<=n)}});i.addPattern("length",{argument:true,message:"长度必须为%argu个字符",validate:function(e,t){var n=parseInt(this.value,10);t(e.length===n)}});i.addPattern("greater_than",{argument:true,message:"必须大于%argu",validate:function(e,t){var n=parseInt(e,10);var r=this.parseNameSymbol(this.value);r=parseFloat(r&&r.tagName?this.getElementValue(r):this.value);t(n>r)}});i.addPattern("less_than",{argument:true,message:"必须小于%argu",validate:function(e,t){var n=parseInt(e,10);var r=this.parseNameSymbol(this.value);r=parseFloat(r&&r.tagName?this.getElementValue(r):this.value);t(n<r)}});i.addPattern("equal",{argument:true,message:"必须等于%argu",validate:function(e,t){var n=parseInt(e,10);var r=this.parseNameSymbol(this.value);r=parseFloat(r&&r.tagName?this.getElementValue(r):this.value);t(n==r)}});i.addPattern("ip",{message:"必须符合ip格式",validate:function(e,t){t(/^((25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})\.){3}(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})$/i.test(e))}});i.addPattern("date",{message:"必须符合日期格式 YYYY-MM-DD",validate:function(e,t){t(/^\d\d\d\d\-\d\d\-\d\d$/.test(e))}})}(t.exports,t,e);e.____MODULES["4f65fcd12eaf8e3d436c0aacb3090d3a"]=t.exports})(this)